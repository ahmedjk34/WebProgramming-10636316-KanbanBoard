<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auth Test - Kanban Task Board</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body data-theme="light">
    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Test Container -->
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="auth-logo">
            <span class="auth-icon">üß™</span>
            <h1 class="auth-title">Authentication Test</h1>
          </div>
          <p class="auth-subtitle">Test the authentication system</p>
        </div>

        <div style="text-align: center; margin: 20px 0">
          <h3>Authentication System Test</h3>
          <p>This page tests the authentication system functionality.</p>

          <div style="margin: 20px 0">
            <button
              onclick="testLogin()"
              class="btn btn-primary"
              style="margin: 10px"
            >
              Test Login
            </button>
            <button
              onclick="testSignup()"
              class="btn btn-secondary"
              style="margin: 10px"
            >
              Test Signup
            </button>
            <button
              onclick="testAuthCheck()"
              class="btn btn-info"
              style="margin: 10px"
            >
              Test Auth Check
            </button>
          </div>

          <div
            id="test-results"
            style="
              margin: 20px 0;
              padding: 15px;
              background: var(--bg-glass);
              border-radius: 8px;
              text-align: left;
            "
          >
            <h4>Test Results:</h4>
            <div id="results-content">No tests run yet.</div>
          </div>

          <div style="margin: 20px 0">
            <a href="login.html" class="btn btn-primary">Go to Login</a>
            <a href="signup.html" class="btn btn-secondary">Go to Signup</a>
            <a href="index.html" class="btn btn-info">Go to Main App</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Theme Toggle -->
    <button
      id="theme-toggle"
      class="theme-toggle auth-theme-toggle"
      title="Toggle Dark/Light Mode"
    >
      <span id="theme-icon">üåô</span>
    </button>

    <!-- JavaScript -->
    <script src="utils/js-utils.js"></script>
    <script src="js/auth.js"></script>

    <script>
      // Test functions
      async function testLogin() {
        const resultsDiv = document.getElementById("results-content");
        resultsDiv.innerHTML = "<p>Testing login...</p>";

        try {
          const formData = new FormData();
          formData.append("email", "demo@kanban.com");
          formData.append("password", "demo123");

          const response = await fetch("php/api/auth/login.php", {
            method: "POST",
            body: formData,
          });

          const result = await response.json();

          if (result.success) {
            resultsDiv.innerHTML = `
                        <p style="color: green;">‚úÖ Login test PASSED</p>
                        <p><strong>User:</strong> ${
                          result.data.user.username
                        }</p>
                        <p><strong>Token:</strong> ${result.data.token.substring(
                          0,
                          20
                        )}...</p>
                    `;
          } else {
            resultsDiv.innerHTML = `
                        <p style="color: red;">‚ùå Login test FAILED</p>
                        <p><strong>Error:</strong> ${result.message}</p>
                    `;
          }
        } catch (error) {
          resultsDiv.innerHTML = `
                    <p style="color: red;">‚ùå Login test ERROR</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
        }
      }

      async function testSignup() {
        const resultsDiv = document.getElementById("results-content");
        resultsDiv.innerHTML = "<p>Testing signup...</p>";

        try {
          const formData = new FormData();
          formData.append("first_name", "Test");
          formData.append("last_name", "User");
          formData.append("email", "test" + Date.now() + "@example.com");
          formData.append("username", "testuser" + Date.now());
          formData.append("password", "testpassword123");
          formData.append("terms", "on");

          const response = await fetch("php/api/auth/signup.php", {
            method: "POST",
            body: formData,
          });

          const result = await response.json();

          if (result.success) {
            resultsDiv.innerHTML = `
                        <p style="color: green;">‚úÖ Signup test PASSED</p>
                        <p><strong>User ID:</strong> ${result.data.user_id}</p>
                        <p><strong>Username:</strong> ${result.data.username}</p>
                    `;
          } else {
            resultsDiv.innerHTML = `
                        <p style="color: red;">‚ùå Signup test FAILED</p>
                        <p><strong>Error:</strong> ${result.message}</p>
                    `;
          }
        } catch (error) {
          resultsDiv.innerHTML = `
                    <p style="color: red;">‚ùå Signup test ERROR</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
        }
      }

      async function testAuthCheck() {
        const resultsDiv = document.getElementById("results-content");
        resultsDiv.innerHTML = "<p>Testing auth check...</p>";

        try {
          const response = await fetch("php/api/auth/check_auth.php");
          const result = await response.json();

          if (result.authenticated) {
            resultsDiv.innerHTML = `
                        <p style="color: green;">‚úÖ Auth check PASSED - User is authenticated</p>
                        <p><strong>User:</strong> ${result.data.user.username}</p>
                    `;
          } else {
            resultsDiv.innerHTML = `
                        <p style="color: orange;">‚ö†Ô∏è Auth check - User is NOT authenticated</p>
                        <p><strong>Message:</strong> ${result.message}</p>
                    `;
          }
        } catch (error) {
          resultsDiv.innerHTML = `
                    <p style="color: red;">‚ùå Auth check ERROR</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
        }
      }

      // Setup theme toggle
      document.addEventListener("DOMContentLoaded", function () {
        const themeToggle = document.getElementById("theme-toggle");
        const themeIcon = document.getElementById("theme-icon");

        if (themeToggle && themeIcon) {
          const savedTheme = localStorage.getItem("theme") || "light";
          document.body.setAttribute("data-theme", savedTheme);
          themeIcon.textContent = savedTheme === "dark" ? "‚òÄÔ∏è" : "üåô";

          themeToggle.addEventListener("click", () => {
            const currentTheme = document.body.getAttribute("data-theme");
            const newTheme = currentTheme === "dark" ? "light" : "dark";

            document.body.setAttribute("data-theme", newTheme);
            themeIcon.textContent = newTheme === "dark" ? "‚òÄÔ∏è" : "üåô";
            localStorage.setItem("theme", newTheme);
          });
        }
      });
    </script>
  </body>
</html>
