<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Test - ViewManager Integration</title>
    <link rel="stylesheet" href="css/styles.css" />
    <style>
      .debug-container {
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
        background: var(--bg-primary);
        border-radius: 10px;
        box-shadow: var(--shadow-medium);
      }
      .debug-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--bg-secondary);
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-complete {
        background: #28a745;
      }
      .status-pending {
        background: #ffc107;
      }
      .status-error {
        background: #dc3545;
      }
      .debug-btn {
        display: inline-block;
        padding: 8px 16px;
        margin: 5px;
        background: var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
      }
      .debug-btn:hover {
        background: var(--primary-color-dark);
      }
      .debug-log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        font-family: monospace;
        font-size: 0.85rem;
        max-height: 200px;
        overflow-y: auto;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body data-theme="light">
    <div class="debug-container">
      <header style="text-align: center; margin-bottom: 30px">
        <h1>ğŸ› Debug Test - ViewManager Integration</h1>
        <p>Testing the ViewManager integration and debugging issues</p>
      </header>

      <div class="debug-section">
        <h2>ğŸ” System Status Check</h2>
        <div id="status-check">
          <p>
            <span class="status-indicator status-pending"></span>Checking system
            status...
          </p>
        </div>
      </div>

      <div class="debug-section">
        <h2>ğŸ§ª Manual Tests</h2>
        <button class="debug-btn" onclick="testManagers()">
          Test Managers
        </button>
        <button class="debug-btn" onclick="testViewManager()">
          Test ViewManager
        </button>
        <button class="debug-btn" onclick="testTaskManager()">
          Test TaskManager.getAllTasks
        </button>
        <button class="debug-btn" onclick="clearLog()">Clear Log</button>
      </div>

      <div class="debug-section">
        <h2>ğŸ“‹ Debug Log</h2>
        <div id="debug-log" class="debug-log">
          Debug log will appear here...
        </div>
      </div>

      <div class="debug-section">
        <h2>ğŸ”— Quick Links</h2>
        <a href="index.html" class="debug-btn">Main App</a>
        <a href="dashboard.html" class="debug-btn">Analytics Dashboard</a>
        <a href="test_integration.html" class="debug-btn">Integration Test</a>
      </div>
    </div>

    <script>
      let debugLog = "";

      function log(message) {
        const timestamp = new Date().toLocaleTimeString();
        debugLog += `[${timestamp}] ${message}\n`;
        document.getElementById("debug-log").textContent = debugLog;
        console.log(message);
      }

      function clearLog() {
        debugLog = "";
        document.getElementById("debug-log").textContent =
          "Debug log cleared...";
      }

      function updateStatus(message, status = "pending") {
        const statusElement = document.getElementById("status-check");
        const statusClass = `status-${status}`;
        statusElement.innerHTML = `<p><span class="status-indicator ${statusClass}"></span>${message}</p>`;
      }

      function testManagers() {
        log("ğŸ§ª Testing Managers...");

        const managers = [
          "apiManager",
          "taskManager",
          "projectManager",
          "uiManager",
          "dragDropManager",
        ];

        managers.forEach((manager) => {
          if (window[manager]) {
            log(`âœ… ${manager} is available`);
            if (
              manager === "taskManager" &&
              typeof window[manager].getTasks === "function"
            ) {
              log(`âœ… ${manager}.getTasks is a function`);
            } else if (manager === "taskManager") {
              log(`âŒ ${manager}.getTasks is NOT a function`);
              log(`   Type: ${typeof window[manager].getTasks}`);
              log(
                `   Available methods: ${Object.getOwnPropertyNames(
                  window[manager]
                ).join(", ")}`
              );
            }
            if (
              manager === "projectManager" &&
              typeof window[manager].getProjects === "function"
            ) {
              log(`âœ… ${manager}.getProjects is a function`);
            }
          } else {
            log(`âŒ ${manager} is NOT available`);
          }
        });
      }

      function testViewManager() {
        log("ğŸ§ª Testing ViewManager...");

        if (window.ViewManager) {
          log("âœ… ViewManager class is available");
        } else {
          log("âŒ ViewManager class is NOT available");
        }

        if (window.viewManager) {
          log("âœ… viewManager instance is available");
          log(`   Current view: ${window.viewManager.getCurrentView()}`);
        } else {
          log("âŒ viewManager instance is NOT available");
        }
      }

      async function testTaskManager() {
        log("ğŸ§ª Testing TaskManager.getTasks...");

        if (!window.taskManager) {
          log("âŒ TaskManager not available");
          return;
        }

        if (typeof window.taskManager.getTasks !== "function") {
          log("âŒ getTasks is not a function");
          log(`   Type: ${typeof window.taskManager.getTasks}`);
          return;
        }

        try {
          const tasks = window.taskManager.getTasks();
          log(`âœ… getTasks() returned ${tasks ? tasks.length : 0} tasks`);
        } catch (error) {
          log(`âŒ getTasks() threw error: ${error.message}`);
        }
      }

      // Auto-check status on load
      setTimeout(() => {
        log("ğŸ” Auto-checking system status...");

        // Check if we're on the main app page
        if (
          window.location.pathname.includes("index.html") ||
          window.location.pathname === "/"
        ) {
          updateStatus("Running on main app page", "complete");
        } else {
          updateStatus("Running on debug page", "pending");
        }

        testManagers();
        testViewManager();
      }, 2000);

      // Monitor for manager availability
      let checkCount = 0;
      const maxChecks = 20;

      function monitorManagers() {
        checkCount++;

        if (
          window.taskManager &&
          typeof window.taskManager.getTasks === "function"
        ) {
          log("ğŸ‰ All managers are ready!");
          updateStatus("All managers ready and functional", "complete");
          return;
        }

        if (checkCount < maxChecks) {
          log(`â³ Waiting for managers... (${checkCount}/${maxChecks})`);
          setTimeout(monitorManagers, 1000);
        } else {
          log("âš ï¸ Timeout waiting for managers");
          updateStatus("Timeout waiting for managers", "error");
        }
      }

      // Start monitoring
      setTimeout(monitorManagers, 3000);

      log("ğŸ› Debug page loaded");
    </script>
  </body>
</html>
